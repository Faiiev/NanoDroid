#!/sbin/sh

umask 022
OUTFD=${2}
ZIP=${3}

ZIPDIR=$(dirname "${ZIP}")
MODID=NanoDroid_microG

umount /system &>/dev/null

mkdir /dev/tmp
unzip -o "${ZIP}" CommonInstaller -d "/dev/tmp"
if [ ! -f /dev/tmp/CommonInstaller ]; then
	echo " !! failed to load Common Installer"
	exit 1
else
	source "/dev/tmp/CommonInstaller"
fi

detect_bootmode
detect_outfd

show_banner

mount_partitions
unpack_zip
detect_arch

get_cfg_setup
get_cfg_overlay

detect_mode

install_microg
install_mapsv1
install_gsync
install_store
install_swipe
install_bash
install_nanodroidscripts

nanodroid_finalize

exit 0
